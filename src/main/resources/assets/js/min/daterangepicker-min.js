/**
* @version: 1.3.3
* @author: Dan Grossman http://www.dangrossman.info/
* @date: 2014-01-22
* @copyright: Copyright (c) 2012-2014 Dan Grossman. All rights reserved.
* @license: Licensed under Apache License v2.0. See http://www.apache.org/licenses/LICENSE-2.0
* @website: http://www.improvely.com/
*/
!function($,t){var e=function(t,e,a){this.parentEl="body",this.element=$(t),this.parentEl="object"==typeof e&&e.parentEl&&$(e.parentEl)||$(this.parentEl),this.container=$('<div class="daterangepicker dropdown-menu"><div class="calendar left"></div><div class="calendar right"></div><div class="ranges"><div class="range_inputs"><div class="daterangepicker_start_input"><label for="daterangepicker_start"></label><input class="input-mini" type="text" name="daterangepicker_start" value="" disabled="disabled" /></div><div class="daterangepicker_end_input"><label for="daterangepicker_end"></label><input class="input-mini" type="text" name="daterangepicker_end" value="" disabled="disabled" /></div><button class="applyBtn" disabled="disabled"></button>&nbsp;<button class="cancelBtn"></button></div></div></div>').appendTo(this.parentEl),"object"!=typeof e&&(e={}),this.setOptions(e,a);var i=this.container;$.each(this.buttonClasses,function(t,e){i.find("button").addClass(e)}),this.container.find(".daterangepicker_start_input label").html(this.locale.fromLabel),this.container.find(".daterangepicker_end_input label").html(this.locale.toLabel),this.applyClass.length&&this.container.find(".applyBtn").addClass(this.applyClass),this.cancelClass.length&&this.container.find(".cancelBtn").addClass(this.cancelClass),this.container.find(".applyBtn").html(this.locale.applyLabel),this.container.find(".cancelBtn").html(this.locale.cancelLabel),this.container.on("mousedown",$.proxy(this.mousedown,this)),this.container.find(".calendar").on("click",".prev",$.proxy(this.clickPrev,this)).on("click",".next",$.proxy(this.clickNext,this)).on("click","td.available",$.proxy(this.clickDate,this)).on("mouseenter","td.available",$.proxy(this.enterDate,this)).on("mouseleave","td.available",$.proxy(this.updateFormInputs,this)).on("change","select.yearselect",$.proxy(this.updateMonthYear,this)).on("change","select.monthselect",$.proxy(this.updateMonthYear,this)).on("change","select.hourselect,select.minuteselect,select.ampmselect",$.proxy(this.updateTime,this)),this.container.find(".ranges").on("click","button.applyBtn",$.proxy(this.clickApply,this)).on("click","button.cancelBtn",$.proxy(this.clickCancel,this)).on("click","li",$.proxy(this.clickRange,this)).on("mouseenter","li",$.proxy(this.enterRange,this)).on("mouseleave","li",$.proxy(this.updateFormInputs,this)),this.element.is("input")?this.element.on({"click.daterangepicker":$.proxy(this.show,this),"focus.daterangepicker":$.proxy(this.show,this),"keyup.daterangepicker":$.proxy(this.updateFromControl,this)}):this.element.on("click.daterangepicker",$.proxy(this.show,this))};e.prototype={constructor:e,setOptions:function(e,a){if(this.startDate=t().startOf("day"),this.endDate=t().startOf("day"),this.minDate=!1,this.maxDate=!1,this.dateLimit=!1,this.showDropdowns=!1,this.showWeekNumbers=!1,this.timePicker=!1,this.timePickerIncrement=30,this.timePicker12Hour=!0,this.singleDatePicker=!1,this.ranges={},this.opens="right",this.element.hasClass("pull-right")&&(this.opens="left"),this.buttonClasses=["btn","btn-small"],this.applyClass="btn-blue",this.cancelClass="btn-default",this.format="YYYY/MM/DD",this.separator=" - ",this.locale={applyLabel:"确定",cancelLabel:"取消",fromLabel:"从",toLabel:"到",weekLabel:"W",customRangeLabel:"自定义",daysOfWeek:t()._lang._weekdaysMin.slice(),monthNames:t()._lang._monthsShort.slice(),firstDay:0},this.cb=function(){},"string"==typeof e.format&&(this.format=e.format),"string"==typeof e.separator&&(this.separator=e.separator),"string"==typeof e.startDate&&(this.startDate=t(e.startDate,this.format)),"string"==typeof e.endDate&&(this.endDate=t(e.endDate,this.format)),"string"==typeof e.minDate&&(this.minDate=t(e.minDate,this.format)),"string"==typeof e.maxDate&&(this.maxDate=t(e.maxDate,this.format)),"object"==typeof e.startDate&&(this.startDate=t(e.startDate)),"object"==typeof e.endDate&&(this.endDate=t(e.endDate)),"object"==typeof e.minDate&&(this.minDate=t(e.minDate)),"object"==typeof e.maxDate&&(this.maxDate=t(e.maxDate)),"string"==typeof e.applyClass&&(this.applyClass=e.applyClass),"string"==typeof e.cancelClass&&(this.cancelClass=e.cancelClass),"object"==typeof e.dateLimit&&(this.dateLimit=e.dateLimit),"object"==typeof e.locale){if("object"==typeof e.locale.daysOfWeek&&(this.locale.daysOfWeek=e.locale.daysOfWeek.slice()),"object"==typeof e.locale.monthNames&&(this.locale.monthNames=e.locale.monthNames.slice()),"number"==typeof e.locale.firstDay){this.locale.firstDay=e.locale.firstDay;for(var i=e.locale.firstDay;i>0;)this.locale.daysOfWeek.push(this.locale.daysOfWeek.shift()),i--}"string"==typeof e.locale.applyLabel&&(this.locale.applyLabel=e.locale.applyLabel),"string"==typeof e.locale.cancelLabel&&(this.locale.cancelLabel=e.locale.cancelLabel),"string"==typeof e.locale.fromLabel&&(this.locale.fromLabel=e.locale.fromLabel),"string"==typeof e.locale.toLabel&&(this.locale.toLabel=e.locale.toLabel),"string"==typeof e.locale.weekLabel&&(this.locale.weekLabel=e.locale.weekLabel),"string"==typeof e.locale.customRangeLabel&&(this.locale.customRangeLabel=e.locale.customRangeLabel)}"string"==typeof e.opens&&(this.opens=e.opens),"boolean"==typeof e.showWeekNumbers&&(this.showWeekNumbers=e.showWeekNumbers),"string"==typeof e.buttonClasses&&(this.buttonClasses=[e.buttonClasses]),"object"==typeof e.buttonClasses&&(this.buttonClasses=e.buttonClasses),"boolean"==typeof e.showDropdowns&&(this.showDropdowns=e.showDropdowns),"boolean"==typeof e.singleDatePicker&&(this.singleDatePicker=e.singleDatePicker),"boolean"==typeof e.timePicker&&(this.timePicker=e.timePicker),"number"==typeof e.timePickerIncrement&&(this.timePickerIncrement=e.timePickerIncrement),"boolean"==typeof e.timePicker12Hour&&(this.timePicker12Hour=e.timePicker12Hour);var s,n,r;if(void 0===e.startDate&&void 0===e.endDate&&$(this.element).is("input[type=text]")){var h=$(this.element).val(),o=h.split(this.separator);s=n=null,2==o.length?(s=t(o[0],this.format),n=t(o[1],this.format)):this.singleDatePicker&&(s=t(h,this.format),n=t(h,this.format)),null!==s&&null!==n&&(this.startDate=s,this.endDate=n)}if("object"==typeof e.ranges){for(r in e.ranges)s=t(e.ranges[r][0]),n=t(e.ranges[r][1]),this.minDate&&s.isBefore(this.minDate)&&(s=t(this.minDate)),this.maxDate&&n.isAfter(this.maxDate)&&(n=t(this.maxDate)),this.minDate&&n.isBefore(this.minDate)||this.maxDate&&s.isAfter(this.maxDate)||(this.ranges[r]=[s,n]);var l="<ul>";for(r in this.ranges)l+="<li>"+r+"</li>";l+="<li>"+this.locale.customRangeLabel+"</li>",l+="</ul>",this.container.find(".ranges ul").remove(),this.container.find(".ranges").prepend(l)}if("function"==typeof a&&(this.cb=a),this.timePicker||(this.startDate=this.startDate.startOf("day"),this.endDate=this.endDate.startOf("day")),this.singleDatePicker?(this.opens="right",this.container.find(".calendar.right").show(),this.container.find(".calendar.left").hide(),this.container.find(".ranges").hide(),this.container.find(".calendar.right").hasClass("single")||this.container.find(".calendar.right").addClass("single")):(this.container.find(".calendar.right").removeClass("single"),this.container.find(".ranges").show()),this.oldStartDate=this.startDate.clone(),this.oldEndDate=this.endDate.clone(),this.oldChosenLabel=this.chosenLabel,this.leftCalendar={month:t([this.startDate.year(),this.startDate.month(),1,this.startDate.hour(),this.startDate.minute()]),calendar:[]},this.rightCalendar={month:t([this.endDate.year(),this.endDate.month(),1,this.endDate.hour(),this.endDate.minute()]),calendar:[]},"right"==this.opens){var d=this.container.find(".calendar.left"),c=this.container.find(".calendar.right");d.removeClass("left").addClass("right"),c.removeClass("right").addClass("left")}void 0!==e.ranges||this.singleDatePicker||this.container.find(".calendar").show(),this.container.addClass("opens"+this.opens),this.updateView(),this.updateCalendars()},setStartDate:function(e){"string"==typeof e&&(this.startDate=t(e,this.format)),"object"==typeof e&&(this.startDate=t(e)),this.timePicker||(this.startDate=this.startDate.startOf("day")),this.oldStartDate=this.startDate.clone(),this.updateView(),this.updateCalendars()},setEndDate:function(e){"string"==typeof e&&(this.endDate=t(e,this.format)),"object"==typeof e&&(this.endDate=t(e)),this.timePicker||(this.endDate=this.endDate.startOf("day")),this.oldEndDate=this.endDate.clone(),this.updateView(),this.updateCalendars()},mousedown:function(t){t.stopPropagation()},updateView:function(){this.leftCalendar.month.month(this.startDate.month()).year(this.startDate.year()),this.rightCalendar.month.month(this.endDate.month()).year(this.endDate.year()),this.updateFormInputs()},updateFormInputs:function(){this.container.find("input[name=daterangepicker_start]").val(this.startDate.format(this.format)),this.container.find("input[name=daterangepicker_end]").val(this.endDate.format(this.format)),this.startDate.isSame(this.endDate)||this.startDate.isBefore(this.endDate)?this.container.find("button.applyBtn").removeAttr("disabled"):this.container.find("button.applyBtn").attr("disabled","disabled")},updateFromControl:function(){if(this.element.is("input")&&this.element.val().length){var e=this.element.val().split(this.separator),a=t(e[0],this.format),i=t(e[1],this.format);this.singleDatePicker&&(a=t(this.element.val(),this.format),i=a),i.isBefore(a)||(this.oldStartDate=this.startDate.clone(),this.oldEndDate=this.endDate.clone(),this.startDate=a,this.endDate=i,this.startDate.isSame(this.oldStartDate)&&this.endDate.isSame(this.oldEndDate)||this.notify(),this.updateCalendars())}},notify:function(){this.updateView(),this.cb(this.startDate,this.endDate,this.chosenLabel)},move:function(){var t={top:0,left:0};this.parentEl.is("body")||(t={top:this.parentEl.offset().top-this.parentEl.scrollTop(),left:this.parentEl.offset().left-this.parentEl.scrollLeft()}),"left"==this.opens?(this.container.css({top:this.element.offset().top+this.element.outerHeight()-t.top,right:$(window).width()-this.element.offset().left-this.element.outerWidth()-t.left,left:"auto"}),this.container.offset().left<0&&this.container.css({right:"auto",left:9})):(this.container.css({top:this.element.offset().top+this.element.outerHeight()-t.top,left:this.element.offset().left-t.left,right:"auto"}),this.container.offset().left+this.container.outerWidth()>$(window).width()&&this.container.css({left:"auto",right:0}))},show:function(t){this.element.addClass("active"),this.container.show(),this.move(),t&&(t.stopPropagation(),t.preventDefault()),$(document).on("mousedown",$.proxy(this.hide,this)),this.element.trigger("show.daterangepicker",this)},hide:function(t){this.element.removeClass("active"),this.container.hide(),this.startDate.isSame(this.oldStartDate)&&this.endDate.isSame(this.oldEndDate)||this.notify(),this.oldStartDate=this.startDate.clone(),this.oldEndDate=this.endDate.clone(),$(document).off("mousedown",this.hide),this.element.trigger("hide.daterangepicker",this)},enterRange:function(t){var e=t.target.innerHTML;if(e==this.locale.customRangeLabel)this.updateView();else{var a=this.ranges[e];this.container.find("input[name=daterangepicker_start]").val(a[0].format(this.format)),this.container.find("input[name=daterangepicker_end]").val(a[1].format(this.format))}},showCalendars:function(){this.container.find(".calendar").show(),this.move()},updateInputText:function(){this.element.is("input")&&!this.singleDatePicker?this.element.val(this.startDate.format(this.format)+this.separator+this.endDate.format(this.format)):this.element.is("input")&&this.element.val(this.startDate.format(this.format))},clickRange:function(t){var e=t.target.innerHTML;if(this.chosenLabel=e,e==this.locale.customRangeLabel)this.showCalendars();else{var a=this.ranges[e];this.startDate=a[0],this.endDate=a[1],this.timePicker||(this.startDate.startOf("day"),this.endDate.startOf("day")),this.leftCalendar.month.month(this.startDate.month()).year(this.startDate.year()).hour(this.startDate.hour()).minute(this.startDate.minute()),this.rightCalendar.month.month(this.endDate.month()).year(this.endDate.year()).hour(this.endDate.hour()).minute(this.endDate.minute()),this.updateCalendars(),this.updateInputText(),this.container.find(".calendar").hide(),this.hide(),this.element.trigger("apply.daterangepicker",this)}},clickPrev:function(t){$(t.target).parents(".calendar").hasClass("left")?this.leftCalendar.month.subtract("month",1):this.rightCalendar.month.subtract("month",1),this.updateCalendars()},clickNext:function(t){$(t.target).parents(".calendar").hasClass("left")?this.leftCalendar.month.add("month",1):this.rightCalendar.month.add("month",1),this.updateCalendars()},enterDate:function(t){var e=$(t.target).attr("data-title"),a=e.substr(1,1),i=e.substr(3,1);$(t.target).parents(".calendar").hasClass("left")?this.container.find("input[name=daterangepicker_start]").val(this.leftCalendar.calendar[a][i].format(this.format)):this.container.find("input[name=daterangepicker_end]").val(this.rightCalendar.calendar[a][i].format(this.format))},clickDate:function(e){var a=$(e.target).attr("data-title"),i=a.substr(1,1),s=a.substr(3,1),n=$(e.target).parents(".calendar"),r,h;if(n.hasClass("left")){if(r=this.leftCalendar.calendar[i][s],h=this.endDate,"object"==typeof this.dateLimit){var o=t(r).add(this.dateLimit).startOf("day");h.isAfter(o)&&(h=o)}}else if(r=this.startDate,h=this.rightCalendar.calendar[i][s],"object"==typeof this.dateLimit){var l=t(h).subtract(this.dateLimit).startOf("day");r.isBefore(l)&&(r=l)}if(this.singleDatePicker&&n.hasClass("left")?h=r:this.singleDatePicker&&n.hasClass("right")&&(r=h),n.find("td").removeClass("active"),r.isSame(h)||r.isBefore(h))$(e.target).addClass("active"),this.startDate=r,this.endDate=h;else if(r.isAfter(h)){$(e.target).addClass("active");var d=this.endDate.diff(this.startDate);this.startDate=r,this.endDate=t(r).add("ms",d)}this.leftCalendar.month.month(this.startDate.month()).year(this.startDate.year()),this.rightCalendar.month.month(this.endDate.month()).year(this.endDate.year()),this.updateCalendars(),this.singleDatePicker&&this.clickApply()},clickApply:function(t){this.updateInputText(),this.hide(),this.element.trigger("apply.daterangepicker",this)},clickCancel:function(t){this.startDate=this.oldStartDate,this.endDate=this.oldEndDate,this.chosenLabel=this.oldChosenLabel,this.updateView(),this.updateCalendars(),this.hide(),this.element.trigger("cancel.daterangepicker",this)},updateMonthYear:function(t){var e=$(t.target).closest(".calendar").hasClass("left"),a=this.container.find(".calendar.left");e||(a=this.container.find(".calendar.right"));var i=parseInt(a.find(".monthselect").val(),10),s=a.find(".yearselect").val();e?this.leftCalendar.month.month(i).year(s):this.rightCalendar.month.month(i).year(s),this.updateCalendars()},updateTime:function(t){var e=$(t.target).closest(".calendar").hasClass("left"),a=this.container.find(".calendar.left");e||(a=this.container.find(".calendar.right"));var i=parseInt(a.find(".hourselect").val()),s=parseInt(a.find(".minuteselect").val());if(this.timePicker12Hour){var n=a.find(".ampmselect").val();"PM"==n&&i<12&&(i+=12),"AM"==n&&12==i&&(i=0)}if(e){var r=this.startDate.clone();r.hour(i),r.minute(s),this.startDate=r,this.leftCalendar.month.hour(i).minute(s)}else{var h=this.endDate.clone();h.hour(i),h.minute(s),this.endDate=h,this.rightCalendar.month.hour(i).minute(s)}this.updateCalendars()},updateCalendars:function(){this.leftCalendar.calendar=this.buildCalendar(this.leftCalendar.month.month(),this.leftCalendar.month.year(),this.leftCalendar.month.hour(),this.leftCalendar.month.minute(),"left"),this.rightCalendar.calendar=this.buildCalendar(this.rightCalendar.month.month(),this.rightCalendar.month.year(),this.rightCalendar.month.hour(),this.rightCalendar.month.minute(),"right"),this.container.find(".calendar.left").html(this.renderCalendar(this.leftCalendar.calendar,this.startDate,this.minDate,this.maxDate)),this.container.find(".calendar.right").html(this.renderCalendar(this.rightCalendar.calendar,this.endDate,this.startDate,this.maxDate)),this.container.find(".ranges li").removeClass("active");var t=!0,e=0;for(var a in this.ranges)this.timePicker?this.startDate.isSame(this.ranges[a][0])&&this.endDate.isSame(this.ranges[a][1])&&(t=!1,this.container.find(".ranges li:eq("+e+")").addClass("active")):this.startDate.format("YYYY-MM-DD")==this.ranges[a][0].format("YYYY-MM-DD")&&this.endDate.format("YYYY-MM-DD")==this.ranges[a][1].format("YYYY-MM-DD")&&(t=!1,this.container.find(".ranges li:eq("+e+")").addClass("active")),e++;t&&this.container.find(".ranges li:last").addClass("active")},buildCalendar:function(e,a,i,s,n){var r=t([a,e,1]),h=t(r).subtract("month",1).month(),o=t(r).subtract("month",1).year(),l=t([o,h]).daysInMonth(),d=r.day(),c,f=[];for(c=0;c<6;c++)f[c]=[];var m=l-d+this.locale.firstDay+1;m>l&&(m-=7),d==this.locale.firstDay&&(m=l-6);var p=t([o,h,m,12,s]),u,D;for(c=0,u=0,D=0;c<42;c++,u++,p=t(p).add("hour",24))c>0&&u%7==0&&(u=0,D++),f[D][u]=p.clone().hour(i),p.hour(12);return f},renderDropdowns:function(t,e,a){for(var i=t.month(),s='<select class="monthselect">',n=!1,r=!1,h=0;h<12;h++)s+="<option value='"+h+"'"+(h===i?" selected='selected'":"")+">"+this.locale.monthNames[h]+"</option>";s+="</select>";for(var o=t.year(),l=a&&a.year()||o+5,d=e&&e.year()||o-50,c='<select class="yearselect">',f=d;f<=l;f++)c+='<option value="'+f+'"'+(f===o?' selected="selected"':"")+">"+f+"</option>";return c+="</select>",s+c},renderCalendar:function(t,e,a,i){var s='<div class="calendar-date">';s+='<table class="table-condensed">',s+="<thead>",s+="<tr>",this.showWeekNumbers&&(s+="<th></th>"),!a||a.isBefore(t[1][1])?s+='<th class="prev available"><i class="fa fa-chevron-left"></i></th>':s+="<th></th>";var n=this.locale.monthNames[t[1][1].month()]+t[1][1].format(" YYYY");this.showDropdowns&&(n=this.renderDropdowns(t[1][1],a,i)),s+='<th colspan="5" class="month">'+n+"</th>",!i||i.isAfter(t[1][1])?s+='<th class="next available"><i class="fa fa-chevron-right"></i></th>':s+="<th></th>",s+="</tr>",s+="<tr>",this.showWeekNumbers&&(s+='<th class="week">'+this.locale.weekLabel+"</th>"),$.each(this.locale.daysOfWeek,function(t,e){s+="<th>"+e+"</th>"}),s+="</tr>",s+="</thead>",s+="<tbody>";for(var r=0;r<6;r++){s+="<tr>",this.showWeekNumbers&&(s+='<td class="week">'+t[r][0].week()+"</td>");for(var h=0;h<7;h++){var o="available ";o+=t[r][h].month()==t[1][1].month()?"":"off",a&&t[r][h].isBefore(a)||i&&t[r][h].isAfter(i)?o=" off disabled ":t[r][h].format("YYYY-MM-DD")==e.format("YYYY-MM-DD")?(o+=" active ",t[r][h].format("YYYY-MM-DD")==this.startDate.format("YYYY-MM-DD")&&(o+=" start-date "),t[r][h].format("YYYY-MM-DD")==this.endDate.format("YYYY-MM-DD")&&(o+=" end-date ")):t[r][h]>=this.startDate&&t[r][h]<=this.endDate&&(o+=" in-range ",t[r][h].isSame(this.startDate)&&(o+=" start-date "),t[r][h].isSame(this.endDate)&&(o+=" end-date "));var l="r"+r+"c"+h;s+='<td class="'+o.replace(/\s+/g," ").replace(/^\s?(.*?)\s?$/,"$1")+'" data-title="'+l+'">'+t[r][h].date()+"</td>"}s+="</tr>"}s+="</tbody>",s+="</table>",s+="</div>";var d;if(this.timePicker){s+='<div class="calendar-time">',s+='<select class="hourselect">';var c=0,f=23,m=e.hour();for(this.timePicker12Hour&&(c=1,f=12,m>=12&&(m-=12),0===m&&(m=12)),d=c;d<=f;d++)s+=d==m?'<option value="'+d+'" selected="selected">'+d+"</option>":'<option value="'+d+'">'+d+"</option>";for(s+="</select> : ",s+='<select class="minuteselect">',d=0;d<60;d+=this.timePickerIncrement){var p=d;p<10&&(p="0"+p),d==e.minute()?s+='<option value="'+d+'" selected="selected">'+p+"</option>":s+='<option value="'+d+'">'+p+"</option>"}s+="</select> ",this.timePicker12Hour&&(s+='<select class="ampmselect">',e.hour()>=12?s+='<option value="AM">AM</option><option value="PM" selected="selected">PM</option>':s+='<option value="AM" selected="selected">AM</option><option value="PM">PM</option>',s+="</select>"),s+="</div>"}return s},remove:function(){this.container.remove(),this.element.off(".daterangepicker"),this.element.removeData("daterangepicker")}},$.fn.daterangepicker=function(t,a){return this.each(function(){var i=$(this);i.data("daterangepicker")&&i.data("daterangepicker").remove(),i.data("daterangepicker",new e(i,t,a))}),this}}(window.jQuery,window.moment);